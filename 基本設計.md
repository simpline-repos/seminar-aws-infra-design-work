# 基本設計

基本設計とは、

## 基本設計のインプット・アウトプット

### インプット

前段階の成果物全てがインプットになるが、特に以下が無いと基本設計が行き詰まる。
- 非機能要件定義書

上記では足りないのが殆どなので、このフェーズでも議論や提案は必要

### アウトプット(成果物)

- 基本設計書

## 基本設計で注意するべきこと

PMやPLが注意するべき事、前提として聞いておいた方が良い事等

メンバー・リーダーみんな気を付けるべきこと


# 基本設計で記述すること
基本的に要件定義で出てきた要件をどのような方式で実現するのかを記述するのが基本設計です。

- システムの目的
- システム概要
    - システム構成図
    - ソフトウェア一覧
    - 命名規則
    - タグ
- AWSアカウント設計
    - アカウントセキュリティ
    - IAM ユーザ
- ネットワーク設計
    - VPC・サブネット構成
    - WAN通信
    - AWS API通信
    - インターネット通信
    - ネットワークセキュリティ
    - DNS,NTPのようなネットワーク基本設計
    - ドメイン
- サーバ系要件
    - 計算基盤
    - サーバ構成
    - OS
    - ミドルウェア
    - アプリケーションサーバ
    - DB
    - LB
    - CDN
    - ストレージ
- 非機能系要件
    - 可用性
        - 稼働率
        - RPO/RTO/RLO
        - BCP・DR
    - 性能・拡張性
        - オンライン性能
        - バッチ性能
        - 性能拡張
        - 容量拡張
    - セキュリティ
        - 脆弱性対策（パッチ）
	    - ウィルス対策
        - 攻撃防御どんな攻撃を想定するか、どんな対策をするか
        - 暗号化
        - 監査
    - 保守・運用性
        - 監視
        - ログ
            - 取得・保管対象ログ
                - アクセス分析系
                - 障害調査系
                - 監査系
            - 保管要件
                - 期間
                - 暗号化有無
        - バックアップ・リストア

以下から
---

# システムの目的
誰に何を提供するのが目的というようなことを書きます。以下のような要素が適宜入っていればいいんではないかと。
- システム主幹（誰が）
- 主なエンドユーザ（誰に）
- どんな機能を提供するのか（何を・どんなことを）
- 非機能について特筆することがあれば（どうやって）
- 補足情報があれば必要に応じて（Why, Where, When）

# システム概要
システムの全体像だったり、共通で適用できるような設計事項を書きます。

## システムの構成図
この設計書の中で設計するもの達を１枚以上の構成図で示します。1枚で収まるなら1枚で、規模が大きくて複数枚に分けないと描ききれないのであれば複数枚に分けるといいでしょう。例えば以下のような図があると思います。
- VPCの中だけの図
- AWSアカウント内のその他リソースも含めた図
- WANや外部連携先も含めた図
システムの利用者がどこからアクセスしてくるのか、運用保守のオペレータがどこからアクセスしてくるのかも分かるとよいでしょう。

## ソフトウェア一覧
システムで利用するソフトウェアの一覧です。OSに追加でインストールするミドルウェアや、パッケージソフトの一覧表を作ります。継続的に更新がかかるような環境ではソフトのバージョン番号までは書かない方が良いです。（個人的にはソフトウェア一覧は不要論を唱えています。サポート切れや脆弱性のあるソフトがないかのチェックに主に使われる資料だと思いますが、昨今のAWS環境ではSSMのインベントリとかで確認するのが良いんじゃないかなぁ......）

## 命名規則
各リソースにどんな命名をするのかです。正直これが一番難しいんじやないかな。。。どんなリソースにも適用できる1つのパターンを作ろうとすると詰むので、なにはこういうパターンで命名するというようなものを作成することになるかと。AWSリソースの命名に加えて、コンピュータのホスト名も命名する場合があります。<br>
注意すべきは、名前に使える文字の種類（大文字や、一部の記号、非アルファベット文字が使えるかどうか。AWSリソースによって使えたり使えなかったりするので注意が必要）や文字数（例えば、Windowsのホスト名は15文字まで、ALB名は32文字まで等）の制約です。

## タグ設計
各AWSリソースにどんなタグ付けをするのかを書きます。まず、どんな目的でタグをつけるよという事を決めて書きます。そして、タグキーの一覧と値の例を表にしてあげます。タグを付ける目的については、お客さんと相談することになりますが、タグの利用目的が決めきれなそうであれば詳細は運用設計で定義するとしてしまっても良いです。<br>
以下は代表的なタグの目的です。適宜取捨選択。
- コスト配分
- リソース整理
- 自動化
- アクセス制御

参考
- [AWSリソースのタグ付け](https://docs.aws.amazon.com/ja_jp/general/latest/gr/aws_tagging.html)


# AWSアカウント設計
AWSアカウントの、構成、IAMユーザ、セキュリティ・コンプライアンス系サービスといった、システムの機能に関わらない部分の設計を記述します。

## AWSアカウント構成
マルチアカウント構成にするのであればアカウント設計は別のドキュメントに纏めるのでも良いと思います。

## AWSリージョン構成
AWSリージョンの利用に関する方針

## IAMユーザ
IAMユーザ・グループ・ポリシー設計
運用設計で設計することにしても良いと思います。

## アカウントセキュリティ・コンプライアンス
CloudTrail,AWS Config,GuardDuty,Macie等
運用設計で設計する事にしても良いと思います。


# ネットワーク設計
VPCやDirectConnect、インターネット接続やセキュリティグループといったネットワークに関する設計です。

## ネットワーク構成概要
まず、インターネット,WANを含むシステムのネットワークの全体像と基本的なネットワーク要件（外部接続先、NWセキュリティの方針）を描きます。
- 概要説明
- ネットワーク構成図

## VPC・サブネット構成
VPCとサブネットの構成を書きます。

### VPC設計
VPCとそのCIDR

### サブネット設計
サブネットとそのCIDR,Availability Zone
各サブネットが他のどんなネットワークと通信出来るか

## WAN通信
各VPCが通信するVPC外のプライベートネットワーク
それらと何を介して繋げるか(VyOS等でのセルフマネージドVPN,AWSマネージドVPN, DirectConnect, DX Gateway, Transit Gateway)

## VPC Endpoint
VPC Endpointに関する設計
- VPCエンドポイント一覧（サービス・Gateway型かインタフェース型か）
- VPCエンドポイントポリシーを設定するか、設定するならどんなポリシーか
- インタフェース型VPCエンドポイントについては、AZ構成、プライベートDNS名オプションを有効にするか
## インターネット通信
インターネットへの接続方法、
## ネットワーク通信要件
これまで挙げて来たサブネットとVPC外ネットワークとの間の通信要件(通信できるようにする・しない)を整理して、通信制御方針、つまりルートテーブル・NACL・SGをどのように組み合わせて通信要件を実現するのかを設計します。
- 通信要件まとめ
- 通信制御方針
- ルートテーブル
- NACL
- SG

## ログ
ネットワーク関係のログについてです。取る取らないという要件は要件定義のログ要件で定義したものです。ここがまだ決まっていないのであれば、基本設計フェーズで決めるか、運用設計フェーズで決めるということになります。
VPC Flow Logs
Route53 resolver log

## ネットワーク基本設定(DNS,NTP等)
DHCPオプションセット
DNS系設定について

## ドメイン
パブリックドメイン（インターネットから解決できるDNS名）を取得するのであれば、そのドメイン名、DNSプロバイダ(基本route53が良いですが、Akamai等他CDN使いたい+Zone Apexの扱いによっては...)、解決させる名前と解決先とか？
ローカルドメインを用意するので、あれば、、、
Active Directory Domain Serviceを使うのであれば...


# アプリケーションサービス設計
サービスを構成するロードバランサーやサーバー、データベース等の設計です。どんなサーバ群でサービスを提供するかを設計します。また、それらのパラメータを決定する為の方針を定めます。

## 概要
アプリケーション基盤としてどんな構成にするか、基本方針を示します。
### 計算基盤
計算基盤として何を使用するかを書きます。
EC2インスタンスなのか、コンテナ（ECSかEKSか。データプレーンはEC2かFargateか）、Lambdaを使ってサーバレスかといったことを書きます。

### サーバ構成
アプリケーションのサービスがどんなサーバ等で構成されるかを記述します。
- アプリケーションサーバ構成図(CDN, Load Balancer含む)
- サーバ一覧表

サーバ一覧のレベル感は以下のような感じで良いかなと

| サーバ                 | 基盤・サービス            | 台数                          | 備考（あれば） | 
| ---------------------- | ------------------------- | ----------------------------- | -------------- | 
| CDN                    | CloudFront                | 1                             |                | 
| Webサーバ              | S3                        | 1                             |                | 
| ロードバランサー       | Application Load Balancer | 1                             |                | 
| アプリケーションサーバ | EC2                       | 2台以上（Auto Scaling Group） |                | 
| BIサーバ               | EC2                       | 1                             |                | 
| DBサーバ               | RDS                       | マルチAZ 1台                  |                | 
| 分析用DBサーバ         | RDSリードレプリカ         | シングルAZ 1台                |                | 

## サーバ設計
EC2インスタンスに関する設計を記していく章です。まずは共通設計、それに続けて各サーバの個別設計を行なうと良いでしょう。

### 共通設計
#### OS
#### 共通ミドルウェア

### アプリケーションサーバ設計

## データストア
### データベース
### ストレージ

## 負荷対策装置
### ロードバランサ
### CDN

# 共通機能サーバ設計
## その他コアコンポーネント
### ドメインコントローラ
### ジョブ管理
## 非機能系サーバ
### 監視サーバ
### セキュリティソフト
### 踏み台
### ビルド・CICD

# その他非機能設計
## 稼働率
## RPO/RTO/RLO
## バックアップ・リストア
## BCP・DR
## 性能・拡張性
## セキュリティ
### 脆弱性対策
### ウィルス対策
### その他の攻撃への対策
### 暗号化
### 監査
## 監視
## ログ